<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Vyaguta Leave Data API Documentation</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; }
        h1, h2, h3 { color: #333; }
        code { background: #f4f4f4; padding: 0.2em 0.4em; border-radius: 4px; }
        pre { background: #f4f4f4; padding: 1em; border-radius: 4px; overflow-x: auto; }
        .endpoint { margin-bottom: 1em; }
        .endpoint h3 { margin-top: 0; }
        .parameters, .response { margin-left: 1em; }
        .parameters ul, .response ul { list-style-type: none; padding-left: 0; }
        .parameters li, .response li { margin-bottom: 0.5em; }
        .parameters code { background: none; padding: 0; }
        .response { border-left: 2px solid #333; padding-left: 1em; }
        .response h4 { margin-top: 0; }
        .response p { margin: 0; }
        .example { background: #e9ecef; padding: 1em; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Vyaguta Leave Data API Documentation</h1>
    <h2>Table of Contents</h2>
    <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#authentication">Authentication</a></li>
        <li><a href="#api-endpoints">API Endpoints</a>
            <ul>
                <li><a href="#fetching-and-uploading-data">Fetching and Uploading Data</a></li>
                <li><a href="#etl-process">ETL Process</a></li>
                <li><a href="#sample-visualization">Sample Visualization</a></li>
                <li><a href="#visualize-download">Visualize Download</a></li>
            </ul>
        </li>
        <li><a href="#response-formats">Response Formats</a></li>
    </ul>

    <h2 id="introduction">1. Introduction</h2>
    <p>The Vyaguta Leave Data API allows users to fetch, process, and visualize data related to employee leave from the Vyaguta application. The API is designed to automate data acquisition, ETL (Extract, Transform, Load) processes, and provide sample visualizations in a user-friendly manner.</p>
    <p>This document provides detailed information on the available API endpoints, their parameters, usage examples, and response formats.</p>

    <h2 id="authentication">2. Authentication</h2>
    <p>All API requests require an <code>X-Custom-Passcode</code> header for authorization. The passcode ensures secure access to the API resources. Failure to provide the correct passcode will result in an authentication error.</p>
    <p><strong>Sample Header:</strong></p>
    <pre><code>X-Custom-Passcode: ZG5OalFBPT0hISYhIU1qQXlNdz09</code></pre>

    <h2 id="api-endpoints">3. API Endpoints</h2>

    <div class="endpoint">
        <h3 id="fetching-and-uploading-data">3.1 Fetching and Uploading Data</h3>
        <p>This endpoint triggers the function to acquire leave data from the Vyaguta application. If the <code>start_date</code> and <code>end_date</code> are not provided, the API defaults to using yesterday's date as the <code>start_date</code> and todayâ€™s date as the <code>end_date</code>.</p>
        <h4>URL: <code>/api/v1/acquire/insert</code></h4>
        <h4>Method: <code>POST</code></h4>
        <h4>Headers:</h4>
        <ul>
            <li><code>X-Custom-Passcode</code>: Required, string.</li>
        </ul>
        <h4>Parameters:</h4>
        <ul class="parameters">
            <li><code>start_date</code>: Optional, string in <code>YYYY-MM-DD</code> format. Defaults to yesterday.</li>
            <li><code>end_date</code>: Optional, string in <code>YYYY-MM-DD</code> format. Defaults to today.</li>
        </ul>
        <h4>Response:</h4>
        <div class="response">
            <pre><code>{
    "message": "Insert operation started for leave Table initiated as 2024-09-12"
}</code></pre>
        </div>
        <h4>Usage Example:</h4>
        <pre><code>curl --location 'http://0.0.0.0:4448/api/v1/acquire/insert' \
--header 'X-Custom-Passcode: ZG5OalFBPT0hISYhIU1qQXlNdz09' \
--form 'start_date="2021-01-01"' \
--form 'end_date="2024-10-02"'</code></pre>
    </div>

    <div class="endpoint">
        <h3 id="etl-process">3.2 ETL Process</h3>
        <p>This endpoint triggers the ETL process for specific data sets such as <code>user</code>, <code>leave</code>, and <code>leave_txn</code>. If the <code>inserted_date</code> is not provided, the current date is used. If the <code>etl_name</code> is not specified, the API processes all ETL jobs.</p>
        <h4>URL: <code>/api/v1/etl/load</code></h4>
        <h4>Method: <code>POST</code></h4>
        <h4>Headers:</h4>
        <ul>
            <li><code>X-Custom-Passcode</code>: Required, string.</li>
        </ul>
        <h4>Parameters:</h4>
        <ul class="parameters">
            <li><code>inserted_date</code>: Optional, string in <code>YYYY-MM-DD</code> format. Defaults to today.</li>
            <li><code>etl_name</code>: Optional, string. If not provided, processes <code>user</code>, <code>leave</code>, and <code>leave_txn</code>.</li>
        </ul>
        <h4>Response:</h4>
        <div class="response">
            <pre><code>{
    "message": "ETL process started for user Table as of 2024-09-07"
}</code></pre>
        </div>
        <h4>Usage Example:</h4>
        <pre><code>curl --location 'http://0.0.0.0:4448/api/v1/etl/load' \
--header 'X-Custom-Passcode: ZG5OalFBPT0hISYhIU1qQXlNdz09' \
--form 'inserted_date="2024-09-07"' \
--form 'etl_name="user"'</code></pre>
    </div>

    <div class="endpoint">
        <h3 id="sample-visualization">3.3 Sample Visualization</h3>
        <p>This endpoint provides a sample of the data in HTML format. The sample data includes visualizations such as department analysis, supervisor analysis, designation analysis, and leave days analysis, viewable directly as a web page.</p>
        <h4>URL: <code>/sample</code></h4>
        <h4>Method: <code>GET</code></h4>
        <h4>Headers:</h4>
        <ul>
            <li>None</li>
        </ul>
        <h4>Response:</h4>
        <p>Returns an HTML page with embedded images of various visualizations. The images are transferred in binary format and rendered directly in the browser.</p>
        <h4>Usage Example:</h4>
        <pre><code>curl --location 'http://0.0.0.0:4448/sample'</code></pre>
    </div>

    <div class="endpoint">
        <h3 id="visualize-download">3.4 Visualize Download</h3>
        <p>This endpoint allows the download of visualized data based on different <code>plot_type</code> values. The available plot types include:</p>
        <ul>
            <li><code>department</code>: Visualizes department analysis.</li>
            <li><code>supervisor</code>: Visualizes supervisor analysis.</li>
            <li><code>designation</code>: Visualizes designation analysis.</li>
            <li><code>leave</code>: Visualizes leave analysis.</li>
        </ul>
        <h4>URL: <code>/api/v1/viz/download/{plot_type}</code></h4>
        <h4>Method: <code>GET</code></h4>
        <h4>Headers:</h4>
        <ul>
            <li><code>X-Custom-Passcode</code>: Required, string.</li>
        </ul>
        <h4>Parameters:</h4>
        <ul class="parameters">
            <li><code>plot_type</code>: Required, string. Determines the type of visualization to download.</li>
        </ul>
        <h4>Response:</h4>
        <p>Returns a binary file containing the requested plot type. The content of the file depends on the <code>plot_type</code> provided.</p>
        <h4>Usage Example:</h4>
        <pre><code>curl --location 'http://0.0.0.0:4448/api/v1/viz/download/department' \
--header 'X-Custom-Passcode: ZG5OalFBPT0hISYhIU1qQXlNdz09'</code></pre>
    </div>

    <h2 id="response-formats">4. Response Formats</h2>
    <p>API responses are typically in JSON format. The exact structure of the response depends on the endpoint and the data returned. Below are examples for different endpoints:</p>

    <div class="response">
        <h4>4.1 Response Example for Fetching Data</h4>
        <pre><code>{
    "message": "Insert operation started for leave Table initiated as 2024-09-12"
}</code></pre>
    </div>

    <div class="response">
        <h4>4.2 Response Example for ETL Process</h4>
        <pre><code>{
    "message": "ETL process started for user Table as of 2024-09-07"
}</code></pre>
    </div>

    <div class="response">
        <h4>4.3 Response Example for Sample Visualization</h4>
        <pre><code>HTML content of the sample visualization</code></pre>
    </div>

    <div class="response">
        <h4>4.4 Response Example for Visualize Download</h4>
        <pre><code>Binary file containing the plot</code></pre>
    </div>

</body>
</html>

